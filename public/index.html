<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
    <title>test test aframe</title>


</head>

<body>



    
    <div id="container"></div>

    <script type="module" async>
        let data = [];
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

        let count = 0;


        //data sourced from https://www.kaggle.com/datasets/aliasgherman/tsp-jan2022-gdp-per-quarter?resource=download
        async function f1() {
            const x = await d3.csv("/datafiles/GDP_Quarterly.csv", function (d) { return d })
            return x;
        }

        let y = f1();
        y.then((x) => drawPlot(x))


        //function that does the drawings on aframe

        // Declare the chart dimensions and margins.
        const width = 640;
        const height = 400;
        const marginTop = 20;
        const marginRight = 20;
        const marginBottom = 30;
        const marginLeft = 40;

        let colourArray = [];

        //model view controller
        //model view controller
        //model view controller
        //model view controller
        //model view controller
        //model view controller
        //model view controller
        //reproducibility, reusable
        //https://support.microsoft.com/en-us/office/change-the-display-of-a-3-d-chart-60c13909-d2a1-4e06-8b8c-bccba7868c9b
        //small filter

        //august: at the end of each week, point form, what I did this week. and 
        //a short point for what I will do next week. Kim email. 
        //bar chart 3d with a slider

        // // // Declare the x (horizontal position) scale.
        // const x = d3.scaleUtc()
        //     .domain([new Date("2023-01-01"), new Date("2024-01-01")])
        //     .range([marginLeft, width - marginRight]);

        // // Declare the y (vertical position) scale.
        // const y = d3.scaleLinear()
        //     .domain([0, 100])
        //     .range([height - marginBottom, marginTop]);

        // Create the SVG container.
        const svg1 = d3.create("a-scene")
            .attr("width", width)
            .attr("height", height)
            .attr("id", "test")
        // .call(d3.axisBottom(x));


        // gui-slider.append("a-gui-slider")
        //                  .attr("width", "2.5")
        //                  .attr("height", "0.75")
        //                  .attr("id", "slider")
        //                  .attr("percent", "0.29")
        //                  .attr("margin", "0 0 0.05 0")


        //         <a-gui-slider 	
        // 	width="2.5" height="0.75"
        // 	onclick="slideActionFunction"
        // 	percent="0.29"
        // 	margin="0 0 0.05 0"
        // >
        // </a-gui-slider>



        // // Add the x-axis.

        // svg1.append("g")
        //     .attr("transform", `translate(0,${height - marginBottom})`)
        //     .call(d3.axisBottom(x));


        // svg1.append("g")
        //     .attr("transform", `translate(${marginLeft},0)`)
        //     .call(d3.axisLeft(y));

        // // Add the y-axis.
        // const gx = svg1.append("g")
        //     .attr("transform", `translate(0,${height - marginBottom})`)
        //     .call(d3.axisBottom(x));

        // // Append the SVG element.

        //making a box using A-frame but appeding on d3



        svg1.append("a-box").attr("class", "aplane").attr("position", "0 -10 -10").attr("rotation", `90 0 0`).attr("depth", "0.5").attr("width", "40").attr("height", "20").attr("color", "#7BC8A4")
        //change the position (the -20) based on the number of rows you are going to get
        svg1.append("a-box").attr("class", "aplane").attr("position", "0 0 -20").attr("rotation", `0 0 0`).attr("width", "40").attr("depth", "0.5").attr("height", "20").attr("color", "#888888")
        //svg1.append("a-plane").attr("id", "aplane").attr("position", "-20 0 -20").attr("rotation", `0 -90 0`).attr("width", "40").attr("depth", "1").attr("height", "20").attr("color", "#7BC8A4").attr("visible", "true")
        svg1.append("a-box").attr("class", "aplane").attr("position", "-20 0 -10").attr("rotation", `0 -90 0`).attr("width", "20").attr("depth", "0.5").attr("height", "20").attr("color", "#7BC8A4").attr("visible", "true")


        // svg1.append("a-entity")
        //     .attr("line", `start: -20 ${(Math.pow(50, 1.4) / 100) -3} -20; end: 20 ${(Math.pow(50, 1.4) / 100) -3} -20; color: red`)
        //     .attr("line__2", `start: -20 ${(Math.pow(60, 1.4) / 100) -3} -20; end: 20 ${(Math.pow(60, 1.4) / 100) -3} -20; color: red`)
        //     .attr("line__3", `start: -20 ${(Math.pow(70, 1.4) / 100) -3} -20; end: 20 ${(Math.pow(70, 1.4) / 100) -3} -20; color: red`)
        //     .attr("line__4", `start: -20 ${(Math.pow(80, 1.4) / 100) -3} -20; end: 20 ${(Math.pow(80, 1.4) / 100) -3} -20; color: red`)
        //     .attr("line__5", `start: -20 ${(Math.pow(90, 1.4) / 100) -3} -20; end: 20 ${(Math.pow(90, 1.4) / 100) -3} -20; color: red`)

        //figuring out the height of the lines, DONE
        svg1.append("a-entity")
            .attr("line", `start: -20 ${10} -19.7; end: 20 ${10} -19.7; color: red`)
            .attr("line__1", `start: -20 ${5} -19.7; end: 20 ${5} -19.7; color: red`)
            .attr("line__2", `start: -20 ${0} -19.7; end: 20 ${0} -19.7; color: red`)
            .attr("line__3", `start: -20 ${-5} -19.7; end: 20 ${-5} -19.7; color: red`)
            .attr("line__4", `start: -19.7 ${10} 0; end: -19.7 ${10} -19.7; color: red`)
            .attr("line__5", `start: -19.7 ${5} 0; end: -19.7 ${5} -19.7; color: red`)
            .attr("line__6", `start: -19.7 ${0} 0; end: -19.7 ${0} -19.7; color: red`)
            .attr("line__7", `start: -19.7 ${-5} 0; end: -19.7 ${-5} -19.7; color: red`)
            .attr("line__8", `start: -20 ${7.5} -19.7; end: 20 ${7.5} -19.7; color: red`)
            .attr("line__9", `start: -20 ${2.5} -19.7; end: 20 ${2.5} -19.7; color: red`)
            .attr("line__10", `start: -20 ${-2.5} -19.7; end: 20 ${-2.5} -19.7; color: red`)
            .attr("line__11", `start: -20 ${-7.5} -19.7; end: 20 ${-7.5} -19.7; color: red`)
            .attr("line__12", `start: -19.7 ${7.5} 0; end: -19.7 ${7.5} -19.7; color: red`)
            .attr("line__13", `start: -19.7 ${2.5} 0; end: -19.7 ${2.5} -19.7; color: red`)
            .attr("line__14", `start: -19.7 ${-2.5} 0; end: -19.7 ${-2.5} -19.7; color: red`)
            .attr("line__15", `start: -19.7 ${-7.5} 0; end: -19.7 ${-7.5} -19.7; color: red`)


        svg1.append("a-entity")
            .attr("line", `start: -20 ${-9.7} -3; end: 20 ${-9.7} -3; color: red`)
            .attr("line__1", `start: -20 ${-9.7} -7; end: 20 ${-9.7} -7; color: red`)
            .attr("line__2", `start: -20 ${-9.7} -11; end: 20 ${-9.7} -11; color: red`)


        svg1.append("a-entity")
            .attr("line", `start: -15 ${-9.7} 0; end: -15 ${-9.7} -20; color: red`)
            .attr("line__1", `start: -6 ${-9.7} 0; end: -6 ${-9.7} -20; color: red`)
            .attr("line__2", `start: 3 ${-9.7} 0; end: 3 ${-9.7} -20; color: red`)
            .attr("line__3", `start: 12 ${-9.7} 0; end: 12 ${-9.7} -20; color: red`)


        // .attr("line__2", `start: -20 ${(Math.pow(60, 1.4) / 100) - 10} -19.7; end: 20 ${(Math.pow(60, 1.4) / 100) - 10} -19.7; color: red`)
        // .attr("line__3", `start: -20 ${(Math.pow(70, 1.4) / 100) - 10} -19.7; end: 20 ${(Math.pow(70, 1.4) / 100) - 10} -19.7; color: red`)
        // .attr("line__4", `start: -20 ${(Math.pow(80, 1.4) / 100) - 10} -19.7; end: 20 ${(Math.pow(80, 1.4) / 100) - 10} -19.7; color: red`)



        container.append(svg1.node());


     

        function getColour(country) {
            if (country == "Sweden") {
                return "yellow";
            }
            else if (country == "Finland") {
                return "blue";
            }
            else if (country == "Norway") {
                return "red";
            }
            else {
                return "black"
            }
        }

        function extract(array) {
            let tempArray = [];
            for (let i = 0, count = 1; i < array.length; i++) {
                if (array[i].Country == "Finland") {
                    if (array[i].YearQuarter == `2014Q${count}`) {
                        tempArray.push(["Finland", array[i].YearQuarter, array[i].GDP.replace(",", "")]);
                        count++;
                    }
                }
                else if (array[i].Country == "Sweden") {
                    if (array[i].YearQuarter == `2014Q${count}`) {
                        tempArray.push(["Sweden", array[i].YearQuarter, array[i].GDP.replace(",", "")]);
                        count++;
                    }
                }
                else if (array[i].Country == "Norway") {
                    if (array[i].YearQuarter == `2014Q${count}`) {
                        tempArray.push(["Norway", array[i].YearQuarter, array[i].GDP.replace(",", "")]);
                        count++;
                    }
                }
                if (count == 5)
                    count = 1;
            }
            return tempArray;
        }





        function drawPlot(array) {
            let colourCounter = 0;
            let x = -150;
            let z = -3;

            for (let i = 0; i < array.length; i++) {
                array[i].GDP = array[i].GDP.replace(",", "");
                console.log(typeof (array[i].GDP))
            }



            //extract the data
            let threeDArray = extract(array);
            console.log(threeDArray)

            for (let i = 0; i < threeDArray.length; i++) {
                console.log(threeDArray[i][3])
                let colour = getColour(threeDArray[i][0]);
                console.log(colour)
                //array = array.sort();
                //TODO: add text into on top of the box, done.

                //with a height of 100, the position needs to be at 47
                //with a height of 10, it needs to be -2
                svg1.append("a-box")
                    .attr("id", `abox${i}`)
                    .attr("position", `${x / 10} ${((threeDArray[i][2] / 10000) / 2) - 10} ${z}`)//the position has to be done this way because AFrame puts the position of the boxes at the half point on the height???
                    .attr("height", `${threeDArray[i][2] / 10000}`)
                    .attr("width", 2.5)
                    .attr("depth", 2.5)
                    .attr("rotation", `0 0 0`)
                    .attr("color", `${colour}`);




                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$200000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${10} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$150000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$100000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${0} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$50000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${-5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$175000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${7.5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$125000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${2.5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$75000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${-2.5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")

                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `$25000`)
                    .attr("color", "black")
                    .attr("position", `-24.5 ${-7.5} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")




                //countries labels
                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Finland`)
                    .attr("color", "black")
                    .attr("position", `20.5 ${-9.7} -3`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Norway`)
                    .attr("color", "black")
                    .attr("position", `20.5 ${-9.7} -7`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")

                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Sweden`)
                    .attr("color", "black")
                    .attr("position", `20.5 ${-9.7} -11`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")



                //quarters labels
                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Q1`)
                    .attr("color", "black")
                    .attr("position", `-16 ${-9.7} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Q2`)
                    .attr("color", "black")
                    .attr("position", `-7 ${-9.7} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")

                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Q3`)
                    .attr("color", "black")
                    .attr("position", `2 ${-9.7} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")



                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Q4`)
                    .attr("color", "black")
                    .attr("position", `11 ${-9.7} 0.5`)
                    .attr("width", 25)
                    .attr("height", 10)
                    .attr("text")


                svg1.append("a-text")
                    .attr(`id`, `s${i}`)
                    .attr("value", `Quarterly GDP Sweden, Finland, Norway for 2014`)
                    .attr("color", "black")
                    .attr("position", `-8 ${-10.7} 3`)
                    .attr("width", 20)
                    .attr("height", 8)
                    .attr("text")




                x += 90;
                colourCounter++;
                if ((i + 1) % 4 == 0) {
                    colourCounter = 0;
                    x = -150;
                    z += -4;
                }
            }

            //does not work
            // for (let i = 0; i < array.length; i++) {
            //     document.getElementById(`abox${i}`).addEventListener("click", (e) => {
            //         console.log(array[i].GDP);
            //     })
            // }

        }


        console.log(count)


    </script>


    <style>
        html.a-fullscreen .a-canvas {
            width: 100% !important;
            height: 100% !important;
            top: 50px !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            position: fixed !important;
        }
    </style>
</body>

</html>